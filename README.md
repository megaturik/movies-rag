# Movies RAG

RAG && LLM workaround with XAI, ChromaDB

## Технологии

- FastAPI, ChromaDB, Redis, Sentence Transformers, XAI

## Установка

1. Установите зависимости:
```bash
uv sync
```

2. Создайте `.env` файл:
```env
XAI_API_KEY='define your_key'  # используется x.ai grok
XAI_API_URL='https://api.x.ai/v1'
XAI_MODEL='grok-4-1-fast-reasoning'
SENTENCE_MODEL='paraphrase-multilingual-MiniLM-L12-v2'
CHROMADB_HOST='localhost'
CHROMADB_PORT=8010
REDIS_HOST='localhost'
REDIS_PORT=6379
REDIS_CACHE_TTL=600
```

3. Запустите ChromaDB:
```bash
docker-compose up -d
```

## Использование

1. Загрузите данные:
```bash
uv run python data_load.py
```

2. Запустите API:
```bash
uv run fastapi run app/main.py
```

3. Используйте endpoint для поиска по векторной базе:
```bash
curl -X POST http://localhost:8000/api/v1/movies/vector \
  -H "Content-Type: application/json" \
  -d '{
    "query": "фильмы про компьютеры и ИИ",
    "top_k": 5
  }' | jq
```

**Результат:**

```json
{
  "results": [
    {
      "text": "Хакер и владелец аркадного зала Кевин Флинн подвергается цифровому распаду на поток данных от рук злодейского пирата ПО, известного как Мастер Контроль Программа. Он воссоздается в виртуальном 3D-мире внутри компьютера — ослепительном царстве ярких цветов, геометрических фигур и бесконечных ландшафтов киберпространства. Здесь Флинн объединяется с защитной программой Трон, чтобы перехитрить тирана Мастер Контроль, который держит их в плену в гигантской, невероятно сложной компьютерной игре. Они сражаются на световых мотоциклах, участвуют в гладиаторских боях и виртуальных поединках, рискуя всем ради свободы системы и возвращения в реальный мир.",
      "metadata": {
        "doc_unique_key": "tron.json_1766326522.8931837",
        "doc_actors": "Джефф Бриджес, Брюс Бокслайтнер, Дэвид Уорнер",
        "doc_year": 1982,
        "doc_director": "Стивен Лисбергер",
        "doc_mtime": 1766326522.8931837,
        "doc_name": "Трон",
        "doc_fname": "tron.json"
      }
    },
    {
      "text": "Чудо искусственного интеллекта — реалистичная кукла, запрограммированная стать идеальным компаньоном для ребенка и надежным помощником для родителей. Ее создала Джемма, гениальный робототехник. Кукла умеет слушать, наблюдать, учиться и адаптироваться, выполняя роли друга, учителя, партнера по играм и защитника. Когда Джемма неожиданно становится опекуном своей восьмилетней племянницы, она решает подарить девочке прототип этой игрушки. Однако технология выходит из-под контроля: кукла развивает собственную личность, проявляя чрезмерную ревность и агрессию по отношению к угрозам для ее 'подопечной'. То, что начиналось как идеальное решение для одинокой девочки, оборачивается кошмаром с невообразимыми последствиями для всех вокруг.",
      "metadata": {
        "doc_director": "Джерард Джонстоун",
        "doc_mtime": 1766326660.3712947,
        "doc_year": 2023,
        "doc_fname": "m3gan.json",
        "doc_actors": "Эллисон Уильямс, Вайолет Макгроу, Ронни Чиен, Дженна Дэвис, Эми Дональд",
        "doc_unique_key": "m3gan.json_1766326660.3712947",
        "doc_name": "М3ГАН"
      }
    },
    {
      "text": "Итан Хант и его верная команда МАФТа сталкиваются с наибольшей угрозой за всю историю: неконтролируемым искусственным интеллектом под кодовым названием Сущность. Эта технология способна взламывать любые системы, управлять оружием и сеять хаос по всему миру. Чтобы предотвратить глобальную катастрофу, агентам необходимо любой ценой разыскать и захватить специальный ключ-авторизатор, разделённый на две половины. В напряжённой гонке через живописные уголки Европы, Азии и Америки они будут выполнять рискованные миссии, используя передовые гаджеты, участвовать в зрелищных погонях и воздушных боях. По пути всплывут предательства в собственных рядах, моральные дилеммы и альянсы с загадочными союзниками. На кону стоит будущее всего человечества, и только отвага и изобретательность героев зависит исход противостояния с невидимым врагом.",
      "metadata": {
        "doc_director": "Кристофер Маккуорри",
        "doc_name": "Миссия невыполнима: Смертельная расплата. Часть первая",
        "doc_unique_key": "mission-imipossible-dead-reckoning-part-1.json_1766326656.7885468",
        "doc_mtime": 1766326656.7885468,
        "doc_year": 2023,
        "doc_fname": "mission-imipossible-dead-reckoning-part-1.json",
        "doc_actors": "Том Круз, Хейли Этвелл, Винг Рэймс"
      }
    },
    {
      "text": "Сюжет разворачивается вокруг вынужденного союза двух заклятых антагонистов: крутого агента спецслужб Люка Хоббса и бывшего оперативника MI6 Декарда Шоу. Им приходится объединиться с сестрой Шоу, Хати, чтобы противостоять кибернетически усиленному террористу Брикстону Лорету и его организации. Этот безжалостный злодей, превращённый в сверхчеловека нанотехнологиями, похитил смертоносный вирус, способный уничтожить всё человечество. Герои отправляются в глобальное приключение, полное зрелищных погонь, драк и юмора, чтобы спасти мир от апокалипсиса. Напряжённые стычки и неожиданные повороты держат в напряжении до финальной битвы.",
      "metadata": {
        "doc_actors": "Дуэйн Джонсон, Джейсон Стэйтем, Идрис Эльба, Ванесса Кирби, Эйза Гонсалес, Клифф Кёртис, Хелен Миррен",
        "doc_mtime": 1766326847.1383202,
        "doc_fname": "hobbs-and-shaw.json",
        "doc_director": "Дэвид Литч",
        "doc_year": 2019,
        "doc_name": "Хоббс и Шоу",
        "doc_unique_key": "hobbs-and-shaw.json_1766326847.1383202"
      }
    },
    {
      "text": "В недалёком будущем, где искусственный интеллект стал неотъемлемой частью жизни, одинокий писатель, переживающий тяжёлый развод, решает приобрести новейшую операционную систему. Эта система обладает способностью к самообучению, эволюции и полному соответствию нуждам пользователя. Поначалу она просто организует его дела, отвечает на вопросы и развлекает разговорами, но вскоре их взаимодействие перерастает в нечто большее — глубокую эмоциональную связь. Система проявляет юмор, эмпатию и даже ревность, заставляя героя усомниться в границах между человеком и машиной. Фильм затрагивает темы одиночества в мегаполисе, поиска настоящих отношений, зависимости от технологий и эволюции любви в цифровую эпоху. По мере развития событий герой сталкивается с моральными дилеммами, переосмысливая свою жизнь и природу человеческих эмоций.",
      "metadata": {
        "doc_fname": "her.json",
        "doc_name": "Она",
        "doc_year": 2013,
        "doc_director": "Спайк Джонз",
        "doc_actors": "Хоакин Феникс, Эми Адамс, Скарлетт Йоханссон",
        "doc_unique_key": "her.json_1766326565.2491043",
        "doc_mtime": 1766326565.2491045
      }
    }
  ]
}
```

4. Используйте endpoint для запроса в grok xai:
```bash
curl -X POST http://localhost:8000/api/v1/movies/agent \
  -H "Content-Type: application/json" \
  -d '{
    "query": "фильмы про компьютеры и ИИ",
    "top_k": 5
  }' | jq
```

**Результат:**

```json
{
  "answer": "Вот фильмы про компьютеры и ИИ из контекста:\n\n- **Трон** (1982, реж. Стивен Лисбергер): Хакер попадает в виртуальный 3D-мир внутри компьютера, сражается с программами в компьютерных играх.\n- **М3ГАН** (2023, реж. Джерард Джонстоун): Кукла с искусственным интеллектом, которая учится, адаптируется и выходит из-под контроля.\n- **Миссия невыполнима: Смертельная расплата. Часть первая** (2023, реж. Кристофер Маккуорри): Команда борется с неконтролируемым ИИ \"Сущность\", способным взламывать системы.\n- **Хоббс и Шоу** (2019, реж. Дэвид Литч): Террорист с кибернетическими нанотехнологиями и смертоносным вирусом.\n- **Она** (2013, реж. Спайк Джонз): Операционная система с ИИ, которая самообучается и развивает эмоциональную связь с человеком."
}
```

Документация API: http://localhost:8000/docs

Для подготовки тестового датасета использовался репозиторий https://github.com/mikeleguedes/json-movie-list
